# ─────────────────────────────────────────────────────────────────────────────
# PostgreSQL WAL Archiving Configuration
# ─────────────────────────────────────────────────────────────────────────────
# Include this in postgresql.conf to enable WAL archiving for point-in-time
# recovery (PITR). This works alongside pg_dump daily backups for comprehensive
# backup coverage.
#
# Usage:
#   1. Mount this file into the PostgreSQL container
#   2. Add to postgresql.conf: include = '/etc/postgresql/backup.conf'
#   3. Restart PostgreSQL
#
# For S3 archiving, configure these environment variables:
#   S3_BUCKET, S3_PREFIX, S3_ENDPOINT_URL, AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY
# ─────────────────────────────────────────────────────────────────────────────

# Enable WAL archiving
wal_level = replica
archive_mode = on

# Archive WAL segments to the backup volume
# For local archiving (simple, works without S3):
archive_command = 'test ! -f /backups/wal/%f && cp %p /backups/wal/%f'

# For S3 archiving (uncomment and configure):
# archive_command = 'aws s3 cp %p s3://${S3_BUCKET}/${S3_PREFIX}wal/%f --endpoint-url ${S3_ENDPOINT_URL}'

# WAL settings for reliability
max_wal_senders = 3
wal_keep_size = 256MB

# Checkpoint settings
checkpoint_timeout = 15min
checkpoint_completion_target = 0.9
